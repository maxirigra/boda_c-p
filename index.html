<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Nuestra Boda - P & C</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=EB+Garamond:ital,wght@0,400..800;1,400..800&family=Montserrat:wght@400;500;700&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --bg-color: #fbf9f7;
        --text-dark-green: #4a5c43;
        --text-gray: #555555;
        --input-bg: #f5f1ec;
        --border-color: #eae0d5;
      }
      body {
        font-family: 'Montserrat', sans-serif;
        background-color: var(--bg-color);
        color: var(--text-gray);
      }
      .font-garamond {
        font-family: 'EB Garamond', serif;
        color: var(--text-dark-green);
      }
      .btn-primary {
        background-color: var(--text-dark-green);
        color: var(--input-bg);
        border-radius: 8px;
        padding: 12px 28px;
        font-weight: bold;
        transition: background-color 0.3s;
        cursor: pointer;
      }
      .btn-primary:hover {
        background-color: #3b4a36;
      }
      .btn-primary:disabled {
        background-color: #9ca3af;
        cursor: not-allowed;
      }
      .form-input {
        background-color: var(--input-bg);
        border: 1px solid var(--border-color);
        border-radius: 8px;
        width: 100%;
        padding: 12px;
        color: var(--text-gray);
      }
      .form-input:focus {
        outline: none;
        border-color: var(--text-dark-green);
      }
      .carousel-container {
        position: relative;
        max-width: 700px;
        margin: auto;
        overflow: hidden;
        border-radius: 12px;
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.05);
      }
      .carousel-slide {
        display: flex;
        transition: transform 0.5s ease-in-out;
      }
      .carousel-item {
        min-width: 100%;
        box-sizing: border-box;
      }
      .carousel-item img {
        width: 100%;
        display: block;
        aspect-ratio: 4 / 3;
        object-fit: cover;
      }
      .carousel-btn {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        background-color: rgba(255, 255, 255, 0.7);
        border: none;
        color: var(--text-dark-green);
        font-size: 24px;
        padding: 10px 15px;
        border-radius: 50%;
        cursor: pointer;
        z-index: 10;
      }
      .carousel-btn.prev {
        left: 10px;
      }
      .carousel-btn.next {
        right: 10px;
      }
      .timeline {
        position: relative;
        max-width: 400px;
        margin: 0 auto;
      }
      .timeline::after {
        content: '';
        position: absolute;
        width: 2px;
        background-color: var(--border-color);
        top: 0;
        bottom: 0;
        left: 10px;
      }
      .timeline-item {
        padding-left: 40px;
        position: relative;
        margin-bottom: 30px;
      }
      .timeline-item::after {
        content: '♥';
        font-size: 14px;
        color: var(--text-dark-green);
        position: absolute;
        left: 0;
        top: 5px;
        z-index: 1;
      }
      /* Modal Styles */
      .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1000;
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.3s, visibility 0.3s;
      }
      .modal-overlay.visible {
        opacity: 1;
        visibility: visible;
      }
      .modal-content {
        background: white;
        padding: 2rem;
        border-radius: 12px;
        max-width: 500px;
        width: 90%;
        text-align: left;
      }
    </style>
  </head>
  <body class="text-center">
    <!-- Header Section -->
    <header id="home" class="py-24 px-6">
      <h1 class="font-garamond text-7xl md:text-9xl">Patricio & Carolina</h1>
      <p class="mt-4 text-2xl">¡Nos casamos!</p>
      <p class="mt-2 text-xl tracking-widest">21 · FEB · 2026</p>
      <div
        id="countdown-timer"
        class="flex justify-center gap-4 md:gap-8 mt-12 text-lg"
      >
        <div>
          <span id="days" class="block text-4xl font-garamond">00</span
          ><span class="text-xs">días</span>
        </div>
        <div>
          <span id="hours" class="block text-4xl font-garamond">00</span
          ><span class="text-xs">horas</span>
        </div>
        <div>
          <span id="minutes" class="block text-4xl font-garamond">00</span
          ><span class="text-xs">minutos</span>
        </div>
        <div>
          <span id="seconds" class="block text-4xl font-garamond">00</span
          ><span class="text-xs">segundos</span>
        </div>
      </div>
    </header>

    <main>
      <!-- Photo Carousel Section -->
      <section id="fotos" class="py-20">
        <div class="carousel-container">
          <div class="carousel-slide">
            <div class="carousel-item">
              <img
                src="https://i.imgur.com/V8W1jV6.jpeg"
                alt="Foto de la pareja 1"
              />
            </div>
            <div class="carousel-item">
              <img
                src="https://i.imgur.com/Yawebed.jpeg"
                alt="Foto de la pareja 2"
              />
            </div>
          </div>
          <button class="carousel-btn prev">&#10094;</button>
          <button class="carousel-btn next">&#10095;</button>
        </div>
      </section>

      <!-- Itinerary Section -->
      <section id="itinerario" class="py-20 px-6">
        <h2 class="font-garamond text-6xl mb-12">Itinerario</h2>
        <div class="timeline">
          <div class="timeline-item">
            <h3 class="font-garamond text-2xl">CITACIÓN</h3>
            <p>16:30 HRS.</p>
          </div>
          <div class="timeline-item">
            <h3 class="font-garamond text-2xl">CEREMONIA</h3>
            <p>17:30 HRS.</p>
          </div>
          <div class="timeline-item">
            <h3 class="font-garamond text-2xl">CÓCTEL</h3>
            <p>18:30 HRS.</p>
          </div>
          <div class="timeline-item">
            <h3 class="font-garamond text-2xl">CENA</h3>
            <p>21:00 HRS.</p>
          </div>
          <div class="timeline-item">
            <h3 class="font-garamond text-2xl">FIESTA</h3>
            <p>23:00 HRS.</p>
          </div>
        </div>
      </section>

      <!-- Location Section -->
      <section id="ubicacion" class="py-20 px-6 bg-white">
        <h2 class="font-garamond text-6xl mb-6">Ubicación</h2>
        <p class="text-xl">Viña William Cole</p>
        <p class="mb-8">F-840, Casablanca, Valparaíso</p>
        <div class="max-w-4xl mx-auto h-96 rounded-lg overflow-hidden border">
          <iframe
            src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3330.403043836301!2d-71.4116540234499!3d-33.29170017340698!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x96623c106411516b%3A0x87a532e8790089e2!2sVi%C3%B1a%20William%20Cole!5e0!3m2!1ses-419!2scl!4v1722188888888!5m2!1ses-419!2scl"
            width="100%"
            height="100%"
            style="border: 0"
            allowfullscreen=""
            loading="lazy"
            referrerpolicy="no-referrer-when-downgrade"
          ></iframe>
        </div>
      </section>

      <!-- Dress Code Section -->
      <section id="dresscode" class="py-20 px-6">
        <div
          class="max-w-3xl mx-auto p-10 rounded-lg"
          style="
            background-color: var(--text-dark-green);
            color: var(--input-bg);
          "
        >
          <i
            class="fas fa-tshirt text-3xl mb-4"
            style="color: var(--input-bg)"
          ></i>
          <h2
            class="font-garamond text-5xl mb-6"
            style="color: var(--input-bg)"
          >
            Dress Code
          </h2>
          <p class="text-lg leading-relaxed">
            Nuestro matrimonio será de tarde - noche, en jardín encantado,
            elegante el estilo, como siempre hemos soñado. Cuida tus zapatos,
            que el pasto es traicionero, pero la noche será mágica, eso sí es
            certero. Ellos, traje formal deberán lucir, ellas, vestido largo
            para resplandecer y brillar. La puntualidad será nuestro mejor
            aliado. En cuanto a colores, todo vale y es bienvenido, menos blanco
            o afines… pues a la novia van dirigidos.
          </p>
        </div>
      </section>

      <!-- Gift List Section -->
      <section id="regalos" class="py-20 px-6 bg-white">
        <i
          class="fas fa-gift text-3xl mb-4"
          style="color: var(--text-dark-green)"
        ></i>
        <h2 class="font-garamond text-6xl mb-6">Lista de Regalos</h2>
        <p class="max-w-2xl mx-auto mb-12">
          Su presencia es nuestro mejor regalo, pero si desean tener un detalle
          con nosotros, aquí les dejamos algunas ideas.
        </p>

        <div
          class="max-w-md mx-auto mb-12 p-6 rounded-lg text-left"
          style="
            background-color: var(--input-bg);
            border: 1px solid var(--border-color);
          "
        >
          <h3 class="font-garamond text-2xl mb-4 text-center">
            Datos para Transferencia
          </h3>
          <p class="mb-1"><strong>Banco:</strong> Mercado Pago</p>
          <p class="mb-1"><strong>Nombre:</strong> Carolina Aguilar Aldunate</p>
          <p class="mb-1"><strong>Tipo de Cuenta:</strong> Cuenta Vista</p>
          <p class="mb-1"><strong>Número de Cuenta:</strong> 1022788866</p>
          <p class="mb-1"><strong>RUT:</strong> 17.120.604-9</p>
          <p><strong>Email:</strong> carolina.aguilar.aldunate@gmail.com</p>
        </div>

        <div
          id="gift-list-container"
          class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8 max-w-5xl mx-auto"
        >
          <!-- Los regalos se cargarán aquí dinámicamente -->
          <p>Cargando regalos...</p>
        </div>
      </section>

      <!-- DJ & Music Section -->
      <section id="musica" class="py-20 px-6">
        <i
          class="fas fa-music text-3xl mb-4"
          style="color: var(--text-dark-green)"
        ></i>
        <h2 class="font-garamond text-6xl mb-6">Sé nuestro DJ</h2>
        <p class="max-w-2xl mx-auto mb-12">
          ¡Motívate y agrega los hits que no pueden faltar en la fiesta con esta
          Playlist colaborativa de Spotify!
        </p>
        <div
          class="flex flex-wrap justify-center items-start gap-12 max-w-5xl mx-auto"
        >
          <div class="w-full md:w-1/2 lg:w-1/3">
            <iframe
              style="border-radius: 12px"
              src="https://open.spotify.com/embed/playlist/08lV02ypY73Mx3CyNqJNdZ?utm_source=generator&theme=0"
              width="100%"
              height="380"
              frameborder="0"
              allowfullscreen=""
              allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"
              loading="lazy"
            ></iframe>
          </div>
          <div
            class="w-full md:w-1/2 lg:w-1/3 text-left p-8 rounded-lg"
            style="background-color: var(--text-dark-green)"
          >
            <h3
              class="font-garamond text-3xl mb-4"
              style="color: var(--input-bg)"
            >
              Sugiere una canción
            </h3>
            <form id="song-form">
              <div class="mb-4">
                <input
                  type="text"
                  id="song-name"
                  name="song"
                  class="form-input"
                  required
                  placeholder="Canción y Artista"
                />
              </div>
              <div class="mb-4">
                <input
                  type="text"
                  id="guest-name"
                  name="guest"
                  class="form-input"
                  placeholder="Tu nombre (opcional)"
                />
              </div>
              <div class="text-center">
                <button
                  type="submit"
                  id="song-submit-button"
                  class="btn-primary"
                  style="
                    background-color: var(--input-bg);
                    color: var(--text-dark-green);
                  "
                >
                  Agregar canción
                </button>
              </div>
            </form>
            <div
              id="song-form-message"
              class="mt-4 text-center"
              style="color: var(--input-bg)"
            ></div>
          </div>
        </div>
      </section>

      <!-- RSVP Section -->
      <section id="asistencia" class="py-20 px-6">
        <div
          class="max-w-2xl mx-auto p-10 rounded-lg"
          style="
            background-color: var(--text-dark-green);
            color: var(--input-bg);
          "
        >
          <h2
            class="font-garamond text-5xl mb-4"
            style="color: var(--input-bg)"
          >
            Confirma tu Asistencia
          </h2>
          <p class="mb-8">
            Rellena el siguiente formulario individualmente por cada persona que
            asistirá.
          </p>
          <form id="rsvp-form" class="text-left">
            <div class="mb-4">
              <label for="name" class="block mb-2">Nombre y apellido</label>
              <input
                type="text"
                id="name"
                name="name"
                class="form-input"
                required
              />
            </div>
            <div class="mb-4">
              <label for="phone" class="block mb-2">Teléfono</label>
              <input type="tel" id="phone" name="phone" class="form-input" />
            </div>
            <div class="mb-4">
              <label class="block mb-2">¿Asistirás?</label>
              <select name="attendance" class="form-input" required>
                <option value="">Selecciona una opción...</option>
                <option value="Si">¡Sí, allí estaré!</option>
                <option value="No">No podré asistir</option>
              </select>
            </div>
            <div class="mb-6">
              <label for="food" class="block mb-2"
                >Requerimientos Alimenticios (alergias, intolerancias,
                etc.)</label
              >
              <textarea
                id="food"
                name="food"
                rows="3"
                class="form-input"
              ></textarea>
            </div>
            <div class="text-center">
              <button
                type="submit"
                id="rsvp-submit-button"
                class="btn-primary"
                style="
                  background-color: var(--input-bg);
                  color: var(--text-dark-green);
                "
              >
                Enviar
              </button>
            </div>
          </form>
          <div id="rsvp-form-message" class="mt-6 text-lg"></div>
        </div>
      </section>
    </main>

    <!-- More Info Section -->
    <section id="info" class="py-20 px-6">
      <i
        class="fas fa-info-circle text-3xl mb-4"
        style="color: var(--text-dark-green)"
      ></i>
      <h2 class="font-garamond text-6xl mb-8">Más Información</h2>
      <div class="flex justify-center gap-4">
        <button
          id="open-hotels-modal"
          class="py-3 px-6 rounded-lg transition-transform hover:scale-105"
          style="
            background-color: var(--input-bg);
            border: 1px solid var(--border-color);
          "
        >
          Hoteles cercanos
        </button>
        <button
          id="open-dudas-modal"
          class="py-3 px-6 rounded-lg transition-transform hover:scale-105"
          style="
            background-color: var(--input-bg);
            border: 1px solid var(--border-color);
          "
        >
          ¿Dudas?
        </button>
      </div>
    </section>

    <!-- Gift Modal -->
    <div id="gift-modal" class="modal-overlay">
      <div class="modal-content">
        <h3 class="font-garamond text-3xl mb-4">¡Gracias por tu regalo!</h3>
        <p class="mb-6">
          Estás a punto de regalar "<span
            id="modal-gift-name"
            class="font-bold"
          ></span
          >". Por favor, déjanos tu nombre para saber que fuiste tú.
        </p>
        <form id="gift-form">
          <div class="mb-4">
            <label for="gifter-name" class="block mb-2"
              >Tu nombre y apellido</label
            >
            <input
              type="text"
              id="gifter-name"
              name="gifterName"
              class="form-input"
              required
            />
            <input type="hidden" id="gift-id" name="giftId" />
          </div>
          <div class="flex justify-end gap-4">
            <button
              type="button"
              id="modal-cancel"
              class="py-2 px-6 rounded-lg"
            >
              Cancelar
            </button>
            <button type="submit" id="modal-confirm" class="btn-primary">
              Confirmar Regalo
            </button>
          </div>
          <div id="gift-form-message" class="mt-4 text-center"></div>
        </form>
      </div>
    </div>

    <!-- Hotels Modal -->
    <div id="hotels-modal" class="modal-overlay">
      <div class="modal-content relative">
        <button
          class="absolute top-2 right-4 text-3xl font-light modal-close-btn"
        >
          &times;
        </button>
        <h3 class="font-garamond text-3xl mb-4">Hoteles Cercanos</h3>
        <p>Puedes encontrar hoteles cercanos en el siguiente enlace:</p>
        <a
          href="https://maps.app.goo.gl/Uj6wcTWnn4vtdBJ3A"
          target="_blank"
          rel="noopener noreferrer"
          class="text-blue-600 hover:underline break-all"
          >https://maps.app.goo.gl/Uj6wcTWnn4vtdBJ3A</a
        >
      </div>
    </div>

    <!-- Dudas Modal -->
    <div id="dudas-modal" class="modal-overlay">
      <div class="modal-content relative">
        <button
          class="absolute top-2 right-4 text-3xl font-light modal-close-btn"
        >
          &times;
        </button>
        <h3 class="font-garamond text-3xl mb-4">¿Dudas?</h3>
        <p>
          Para cualquier consulta, no dudes en contactarnos al siguiente número:
          +56 9 1234 5678 (Carolina).
        </p>
      </div>
    </div>

    <footer class="py-20 text-center">
      <p class="text-xl">¡Te esperamos!</p>
      <p class="font-garamond text-6xl mt-2">P & C</p>
    </footer>

    <script>
      // --- CONFIGURACIÓN ---
      const weddingDate = new Date('February 21, 2026 16:30:00').getTime();
      const googleScriptURL =
        'https://script.google.com/macros/s/AKfycbxmEI2mtpVh5YqjpSP-0w1FBasHwN9C6WvSfQdJFT0tSnDonOXIytapicpnfV_SU7oI/exec';
      // ---------------------

      document.addEventListener('DOMContentLoaded', () => {
        // Countdown Timer Logic
        const countdownInterval = setInterval(() => {
          const now = new Date().getTime();
          const distance = weddingDate - now;
          if (distance < 0) {
            clearInterval(countdownInterval);
            document.getElementById('countdown-timer').innerHTML =
              "<div class='text-3xl font-garamond'>¡El gran día ha llegado!</div>";
            return;
          }
          document.getElementById('days').innerText = Math.floor(
            distance / (1000 * 60 * 60 * 24)
          );
          document.getElementById('hours').innerText = Math.floor(
            (distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60)
          );
          document.getElementById('minutes').innerText = Math.floor(
            (distance % (1000 * 60 * 60)) / (1000 * 60)
          );
          document.getElementById('seconds').innerText = Math.floor(
            (distance % (1000 * 60)) / 1000
          );
        }, 1000);

        // Photo Carousel Logic
        const slide = document.querySelector('.carousel-slide');
        const items = document.querySelectorAll('.carousel-item');
        if (slide && items.length > 0) {
          const nextBtn = document.querySelector('.carousel-btn.next');
          const prevBtn = document.querySelector('.carousel-btn.prev');
          let counter = 0;
          let size = items[0].clientWidth;

          function updateSlide() {
            size = items[0].clientWidth;
            slide.style.transform = 'translateX(' + -size * counter + 'px)';
          }

          nextBtn.addEventListener('click', () => {
            if (counter >= items.length - 1) counter = -1;
            counter++;
            updateSlide();
          });

          prevBtn.addEventListener('click', () => {
            if (counter <= 0) counter = items.length;
            counter--;
            updateSlide();
          });
          window.addEventListener('resize', updateSlide);
          updateSlide();
        }

        // Generic Form Submission Function
        function handleFormSubmit(formId, buttonId, messageId, formType) {
          const form = document.getElementById(formId);
          const submitButton = document.getElementById(buttonId);
          const formMessage = document.getElementById(messageId);

          form.addEventListener('submit', (e) => {
            e.preventDefault();
            if (googleScriptURL === 'URL_DE_TU_SCRIPT_AQUI') {
              formMessage.textContent =
                'Error: La URL del script no está configurada.';
              formMessage.style.color = 'red';
              return;
            }

            const originalButtonText = submitButton.innerHTML;
            submitButton.disabled = true;
            submitButton.innerHTML = `<i class="fas fa-spinner fa-spin"></i>`;

            const formData = new FormData(form);
            formData.append('formType', formType);

            const data = new URLSearchParams();
            for (const pair of formData) {
              data.append(pair[0], pair[1]);
            }

            fetch(googleScriptURL, {
              method: 'POST',
              body: data,
            })
              .then((res) => res.json())
              .then((response) => {
                if (response.result === 'success') {
                  formMessage.textContent =
                    '¡Gracias! Tu respuesta ha sido enviada.';
                  formMessage.style.color =
                    formId === 'song-form' ? 'var(--input-bg)' : 'green';
                  form.reset();
                } else {
                  throw new Error(response.message || 'Ocurrió un error.');
                }
              })
              .catch((error) => {
                formMessage.textContent = `Error: ${error.message}`;
                formMessage.style.color = 'red';
              })
              .finally(() => {
                submitButton.disabled = false;
                submitButton.innerHTML = originalButtonText;
                setTimeout(() => {
                  formMessage.textContent = '';
                }, 5000);
              });
          });
        }

        handleFormSubmit(
          'rsvp-form',
          'rsvp-submit-button',
          'rsvp-form-message',
          'rsvp'
        );
        handleFormSubmit(
          'song-form',
          'song-submit-button',
          'song-form-message',
          'song'
        );

        // --- GIFT LIST LOGIC ---
        const giftListContainer = document.getElementById(
          'gift-list-container'
        );
        const giftModal = document.getElementById('gift-modal');
        const modalCancelBtn = document.getElementById('modal-cancel');
        const giftForm = document.getElementById('gift-form');

        function renderGifts(gifts) {
          giftListContainer.innerHTML = '';
          const giftGroups = {};

          gifts.forEach((gift) => {
            if (!giftGroups[gift.nombre]) {
              giftGroups[gift.nombre] = {
                name: gift.nombre,
                price: gift.precio,
                items: [],
              };
            }
            giftGroups[gift.nombre].items.push(gift);
          });

          for (const groupName in giftGroups) {
            const group = giftGroups[groupName];
            const availableItems = group.items.filter(
              (item) =>
                item.estado && item.estado.toLowerCase() === 'disponible'
            );
            const isAvailable = availableItems.length > 0;

            const giftElement = document.createElement('div');
            giftElement.className =
              'bg-white p-6 rounded-lg border border-[var(--border-color)] text-left';
            giftElement.innerHTML = `
                        <h3 class="font-garamond text-2xl">${group.name}</h3>
                        <p class="text-lg font-semibold my-2">${new Intl.NumberFormat(
                          'es-CL',
                          { style: 'currency', currency: 'CLP' }
                        ).format(group.price)}</p>
                        <p class="text-sm text-gray-500 mb-4">Disponibles: ${
                          availableItems.length
                        }</p>
                        <button class="btn-primary w-full mt-2 gift-button" data-gift-id="${
                          isAvailable ? availableItems[0].id : ''
                        }" data-gift-name="${group.name}" ${
              !isAvailable ? 'disabled' : ''
            }>
                            ${isAvailable ? 'Regalar' : 'Obsequiado'}
                        </button>
                    `;
            giftListContainer.appendChild(giftElement);
          }
        }

        async function fetchGifts() {
          if (googleScriptURL === 'URL_DE_TU_SCRIPT_AQUI') {
            giftListContainer.innerHTML =
              '<p class="text-red-600 font-bold">Error: Debes pegar la URL de tu script de Google en la variable "googleScriptURL" dentro del código HTML.</p>';
            return;
          }
          try {
            const response = await fetch(`${googleScriptURL}?action=getGifts`);
            if (!response.ok)
              throw new Error(
                `El servidor respondió con un error: ${response.status} ${response.statusText}`
              );
            const data = await response.json();
            if (data.result === 'success') {
              renderGifts(data.gifts);
            } else {
              throw new Error(
                data.message ||
                  'El script devolvió un error al cargar los regalos.'
              );
            }
          } catch (error) {
            giftListContainer.innerHTML = `<p class="text-red-600 text-left"><strong>No se pudieron cargar los regalos.</strong><br><small><strong>Mensaje:</strong> ${error.message}<br><strong>Sugerencia:</strong> Verifica que la URL del script sea correcta, que el script esté implementado con acceso para "Cualquier usuario" y que la pestaña "Regalos" en tu Google Sheet esté bien configurada.</small></p>`;
          }
        }

        giftListContainer.addEventListener('click', (e) => {
          if (
            e.target.classList.contains('gift-button') &&
            !e.target.disabled
          ) {
            const giftId = e.target.dataset.giftId;
            const giftName = e.target.dataset.giftName;
            document.getElementById('modal-gift-name').textContent = giftName;
            document.getElementById('gift-id').value = giftId;
            giftModal.classList.add('visible');
          }
        });

        modalCancelBtn.addEventListener('click', () => {
          giftModal.classList.remove('visible');
        });

        giftForm.addEventListener('submit', (e) => {
          e.preventDefault();
          const submitButton = document.getElementById('modal-confirm');
          const formMessage = document.getElementById('gift-form-message');
          const originalButtonText = submitButton.innerHTML;
          submitButton.disabled = true;
          submitButton.innerHTML = `<i class="fas fa-spinner fa-spin"></i>`;

          const formData = new FormData(giftForm);
          formData.append('formType', 'gift');
          const data = new URLSearchParams();
          for (const pair of formData) {
            data.append(pair[0], pair[1]);
          }

          fetch(googleScriptURL, {
            method: 'POST',
            body: data,
          })
            .then((res) => res.json())
            .then((response) => {
              if (response.result === 'success') {
                giftModal.classList.remove('visible');
                fetchGifts(); // Recargar la lista de regalos
              } else {
                throw new Error(response.message || 'Ocurrió un error.');
              }
            })
            .catch((error) => {
              formMessage.textContent = `Error: ${error.message}`;
              formMessage.style.color = 'red';
            })
            .finally(() => {
              submitButton.disabled = false;
              submitButton.innerHTML = originalButtonText;
              giftForm.reset();
              setTimeout(() => {
                formMessage.textContent = '';
              }, 5000);
            });
        });

        fetchGifts();

        // --- MORE INFO MODALS ---
        const openHotelsBtn = document.getElementById('open-hotels-modal');
        const openDudasBtn = document.getElementById('open-dudas-modal');
        const hotelsModal = document.getElementById('hotels-modal');
        const dudasModal = document.getElementById('dudas-modal');

        const setupInfoModal = (button, modal) => {
          if (button && modal) {
            button.addEventListener('click', () =>
              modal.classList.add('visible')
            );
            modal.addEventListener('click', (e) => {
              if (
                e.target === modal ||
                e.target.classList.contains('modal-close-btn')
              ) {
                modal.classList.remove('visible');
              }
            });
          }
        };

        setupInfoModal(openHotelsBtn, hotelsModal);
        setupInfoModal(openDudasBtn, dudasModal);
      });
    </script>
  </body>
</html>
